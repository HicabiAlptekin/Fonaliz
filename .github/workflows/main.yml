name: Günlük Fon Taraması ve Kontrol

on:
  schedule:
    # Türkiye saati ile 10:45 (UTC 07:45)
    # Cronin "minute hour day_of_month month day_of_week" formatındadır.
    # Bursa, Türkiye UTC+3 olduğundan, 10:45 TRT için 07:45 UTC'dir.
    - cron: '45 7 * * 1-5' # Pazartesi-Cuma

  # Manuel olarak çalıştırma yeteneği
  workflow_dispatch:

jobs:
  tarama:
    runs-on: ubuntu-latest

    steps:
    - name: Kodu Çek
      uses: actions/checkout@v4

    - name: Python Ortamını Kur
      uses: actions/setup-python@v5
      with:
        python-version: '3.x' # Python 3.x sürümünü kullanır

    - name: Bağımlılıkları Yükle
      run: |
        pip install pandas numpy gspread pytz python-dateutil tefas tqdm openpyxl selenium # selenium paketi de gereklidir.
        pip install webdriver-manager # BU SATIR EKLENDİ

    - name: İlk Veri Taramasını Çalıştır
      id: startup_scan
      run: python tarama_script.py
      env:
        GITHUB_OUTPUT: ${{ steps.startup_scan.outputs }}

    - name: Boş Veri Kontrolü ve Yeniden Çalıştırma (Gerekliyse)
      if: steps.startup_scan.outputs.needs_retry == 'true'
      run: |
        echo "5 veya daha fazla boş fiyat verisi tespit edildi. 25 dakika bekleyip tekrar denenecek."
        sleep 1500
        echo "Yeniden tarama başlatılıyor..."
        python tarama_script.py
