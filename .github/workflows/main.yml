name: Günlük Fon Taraması ve Kontrol

on:
  schedule:
    # Türkiye saati ile 10:45 (UTC 07:45)
    # Cronin "minute hour day_of_month month day_of_week" formatındadır.
    # Bursa, Türkiye UTC+3 olduğundan, 10:45 TRT için 07:45 UTC'dir.
    - cron: '45 7 * * 1-5' # Pazartesi-Cuma

  # Manuel olarak çalıştırma yeteneği
  workflow_dispatch:

jobs:
  tarama:
    runs-on: ubuntu-latest

    steps:
    - name: Kodu Çek
      uses: actions/checkout@v4

    - name: Python Ortamını Kur
      uses: actions/setup-python@v5
      with:
        python-version: '3.x'

    - name: Bağımlılıkları Yükle
      run: |
        pip install pandas numpy gspread pytz python-dateutil tefas tqdm openpyxl

    - name: İlk Veri Taramasını Çalıştır
      id: startup_scan # Bu adıma bir id veriyoruz - BURASI DOĞRU
      run: python your_scan_script.py # Kendi Python betiğinizin adı
      env:
        # Python betiğinizin çıktılarını yakalamak için gerekli
        # 'needs_retry' çıktısı buradan okunacak
        GITHUB_OUTPUT: ${{ steps.startup_scan.outputs }} # HATA BURADAYDI, DÜZELTİLDİ

    - name: Boş Veri Kontrolü ve Yeniden Çalıştırma (Gerekliyse)
      # Sadece önceki adımın 'needs_retry' çıktısı 'true' ise çalışıyor
      if: steps.startup_scan.outputs.needs_retry == 'true' # HATA BURADAYDI, DÜZELTİLDİ
      run: |
        echo "5 veya daha fazla boş fiyat verisi tespit edildi. 25 dakika bekleyip tekrar denenecek."
        sleep 1500 # 25 dakika * 60 saniye = 1500 saniye
        echo "Yeniden tarama başlatılıyor..."
        python your_scan_script.py # Tarama betiğini tekrar çalıştır
